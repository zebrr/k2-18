# Расчёт метрик для test_line_graph

## Граф: A → B → C → D

Направленный линейный граф с 4 узлами и 3 рёбрами.

### Веса рёбер:
- Все рёбра имеют `weight = 1.0`
- Следовательно, все `inverse_weight = 1.0` (так как 1/1 = 1)
- Это означает, что взвешенные и невзвешенные метрики дадут одинаковые результаты

## 1. Degree Metrics (Метрики степени)

### Подсчёт рёбер
```
Узел A: входящие = 0, исходящие = 1 (к B)
Узел B: входящие = 1 (от A), исходящие = 1 (к C)
Узел C: входящие = 1 (от B), исходящие = 1 (к D)
Узел D: входящие = 1 (от C), исходящие = 0
```

### Degree Centrality
Формула: `degree_centrality = (in_degree + out_degree) / (n - 1)` где n = 4

- A: (0 + 1) / 3 = 1/3 = **0.3333**
- B: (1 + 1) / 3 = 2/3 = **0.6667**
- C: (1 + 1) / 3 = 2/3 = **0.6667**
- D: (1 + 0) / 3 = 1/3 = **0.3333**

## 2. PageRank (с weight='weight')

### Параметры
- Damping factor (d) = 0.85
- Количество узлов (N) = 4
- Телепортация = (1 - d) / N = 0.15 / 4 = 0.0375
- Используются прямые веса рёбер (weight = 1.0 для всех)

### Формула итерации
```
PR(node) = 0.0375 + 0.85 * Σ(PR(predecessor) / out_degree(predecessor))
```

### Итерации до сходимости

| Итерация | PR(A) | PR(B) | PR(C) | PR(D) | Сумма |
|----------|-------|-------|-------|-------|-------|
| 0 | 0.2500 | 0.2500 | 0.2500 | 0.2500 | 1.000 |
| 1 | 0.0375 | 0.2500 | 0.2500 | 0.2500 | 1.000 |
| 2 | 0.0375 | 0.0694 | 0.2500 | 0.2500 | 0.607 |
| 3 | 0.0375 | 0.0694 | 0.0964 | 0.2500 | 0.453 |
| ... | ... | ... | ... | ... | ... |
| 20 | 0.0375 | 0.0694 | 0.1419 | 0.7512 | 1.000 |

### Финальные значения PageRank
- A: **0.0375** (минимум - нет входящих рёбер)
- B: **0.0694**
- C: **0.1419**
- D: **0.7512** (максимум - накапливает весь поток)

**Проверка**: 0.0375 + 0.0694 + 0.1419 + 0.7512 = 1.0000 ✓

## 3. Betweenness Centrality (с weight='inverse_weight')

Для расчёта используются inverse_weight = 1.0 (так как все weight = 1.0).
Поэтому кратчайшие пути совпадают с путями по количеству рёбер.

### Все кратчайшие пути между парами узлов

| От | До | Путь | Промежуточные узлы |
|----|----|----|-------------------|
| A | B | A→B | нет |
| A | C | A→B→C | B |
| A | D | A→B→C→D | B, C |
| B | C | B→C | нет |
| B | D | B→C→D | C |
| C | D | C→D | нет |

### Подсчёт betweenness для каждого узла

- **A**: не является промежуточным ни для одного пути → BC = 0
- **B**: промежуточный для путей A→C и A→D → BC = 2
- **C**: промежуточный для путей A→D и B→D → BC = 2
- **D**: не является промежуточным ни для одного пути → BC = 0

### Нормализация
Для directed графа: `BC_norm = BC / ((n-1) * (n-2))` = BC / 6

- A: 0 / 6 = **0.0000**
- B: 2 / 6 = **0.3333**
- C: 2 / 6 = **0.3333**
- D: 0 / 6 = **0.0000**

## 4. Closeness Centrality (с distance='inverse_weight')

Для расчёта расстояний используются inverse_weight = 1.0.
Матрица кратчайших расстояний (сумма inverse_weight вдоль путей):

```
    A   B   C   D
A   0   1   2   3
B   ∞   0   1   2
C   ∞   ∞   0   1
D   ∞   ∞   ∞   0
```

### Out-Closeness (исходящая близость)

Для directed графов NetworkX использует формулу Wasserman-Faust:
- Если достигает все n-1 узлы: `closeness = (n-1) / sum_distances`
- Если достигает k < n-1 узлов: `closeness = (k / sum_distances) * (k / (n-1))`

- **A**: достижимы B,C,D (все 3). Расстояния: 1+2+3 = 6
  - Closeness = 3/6 = **0.5000**
  
- **B**: достижимы C,D (2 из 3). Расстояния: 1+2 = 3
  - Closeness = (2/3) * (2/3) = 4/9 = **0.4444**
  
- **C**: достижим только D (1 из 3). Расстояние: 1
  - Closeness = (1/1) * (1/3) = 1/3 = **0.3333**
  
- **D**: никого не достигает
  - Closeness = **0.0000**

## 5. Проверочные инварианты

✓ **Сумма PageRank = 1.0**
✓ **Betweenness средних узлов > крайних** (характерно для цепи)
✓ **PageRank растёт вдоль цепи** (A < B < C < D)
✓ **Один weakly connected component**

## Интерпретация

1. **PageRank** показывает накопление "важности" вдоль цепи. Узел D получает максимум, так как в него сходятся все пути.

2. **Betweenness** выделяет узлы B и C как "мосты" - через них проходят пути между другими узлами.

3. **Closeness** уменьшается вдоль цепи для out-closeness (0.5 → 0.44 → 0.33 → 0.0).

4. Этот граф - идеальный пример для понимания потоковых метрик в направленных графах.