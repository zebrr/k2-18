# test_disconnected_graph - Пошаговые вычисления метрик

## Структура графа
```
Компонента 0:
A ──(PREREQUISITE, 1.0)──> B ──(PREREQUISITE, 1.0)──> C

Компонента 1:
D ──(ELABORATES, 1.0)──> E
```

- 5 узлов: A, B, C, D, E
- 3 ребра
- 2 компоненты связности

## 1. Degree метрики

### degree_in / degree_out
- A: in=0, out=1 (→B)
- B: in=1, out=1 (A→, →C)
- C: in=1, out=0 (B→)
- D: in=0, out=1 (→E)
- E: in=1, out=0 (D→)

### degree_centrality
Для directed графов: (in + out) / (n - 1) = (in + out) / 4

- A: (0 + 1) / 4 = 0.25
- B: (1 + 1) / 4 = 0.5
- C: (1 + 0) / 4 = 0.25
- D: (0 + 1) / 4 = 0.25
- E: (1 + 0) / 4 = 0.25

## 2. PageRank (α = 0.85)

### Закрытая форма для данного графа
При структуре A→B→C и D→E с висячими C,E:
- β = базовый вклад = (1−α) / (n − α(2+2α+α²))
- A = β = D
- B = β(1+α) = E  
- C = β(1+α+α²)

При α=0.85, n=5:
β = 0.15 / (5 − 0.85·(2 + 1.7 + 0.7225)) = 0.15 / 1.24106 = 0.1208824993

### Итерационный процесс

#### Инициализация
PR⁰ = 1/5 = 0.2 для всех узлов

#### Итерация 1
Dangling nodes (без исходящих): C, E
s = PR(C) + PR(E) = 0.2 + 0.2 = 0.4
base = (1-α)/n + α·s/n = 0.15/5 + 0.85·0.4/5 = 0.03 + 0.068 = 0.098

PR¹(A) = base = 0.098
PR¹(B) = base + α·PR(A)/out(A) = 0.098 + 0.85·0.2/1 = 0.098 + 0.17 = 0.268
PR¹(C) = base + α·PR(B)/out(B) = 0.098 + 0.85·0.2/1 = 0.098 + 0.17 = 0.268
PR¹(D) = base = 0.098
PR¹(E) = base + α·PR(D)/out(D) = 0.098 + 0.85·0.2/1 = 0.098 + 0.17 = 0.268

Сумма = 0.098 + 0.268 + 0.268 + 0.098 + 0.268 = 1.0 ✓

#### После сходимости

**Финальные значения PageRank:**
- A = 0.1208825
- B = 0.2236326
- C = 0.3109697
- D = 0.1208825
- E = 0.2236326

Проверка: 0.1208825 + 0.2236326 + 0.3109697 + 0.1208825 + 0.2236326 = 0.9999999 ≈ 1.0 ✓

**Проверка согласованности:**
- α₁ = B/A − 1 = 0.2236326/0.1208825 − 1 = 0.85 ✓
- α₂ = (C − A)/B = (0.3109697 − 0.1208825)/0.2236326 = 0.85 ✓

## 3. Betweenness Centrality

Для несвязного графа: нет путей между компонентами.

### Компонента 0 (A-B-C)
Кратчайшие пути между всеми парами:
- A→B: путь A-B (длина 1)
- A→C: путь A-B-C (длина 2)
- B→C: путь B-C (длина 1)

Узел B лежит на пути A→C.
σ(A,C) = 1 (один кратчайший путь)
σ(A,C|B) = 1 (проходит через B)

### Компонента 1 (D-E)
- D→E: путь D-E (длина 1)

### Подсчет betweenness
Для directed графов нормализация: 1/((n-1)·(n-2)) = 1/(4·3) = 1/12

- A: никакие пути не проходят через A → bc = 0
- B: 1 путь из 1 (A→C) → bc_raw = 1, bc_norm = 1/12 = 0.0833
- C: никакие пути не проходят через C → bc = 0
- D: никакие пути не проходят через D → bc = 0
- E: никакие пути не проходят через E → bc = 0

## 4. Out-Closeness Centrality (Wasserman-Faust)

inverse_weight = 1/weight = 1.0 для всех рёбер

### Узел A
Достижимые: B (расст=1), C (расст=2)
k = 2, sum_dist = 3
closeness(A) = (k/sum_dist) · (k/(n-1)) = (2/3) · (2/4) = 0.6667 · 0.5 = 0.3333

### Узел B
Достижимые: C (расст=1)
k = 1, sum_dist = 1
closeness(B) = (1/1) · (1/4) = 1.0 · 0.25 = 0.25

### Узел C
Достижимые: нет
k = 0 → closeness(C) = 0

### Узел D
Достижимые: E (расст=1)
k = 1, sum_dist = 1
closeness(D) = (1/1) · (1/4) = 0.25

### Узел E
Достижимые: нет
k = 0 → closeness(E) = 0

## 5. Component ID

Weakly connected components:
- Компонента 0: {A, B, C}
- Компонента 1: {D, E}

component_id:
- A: 0
- B: 0
- C: 0
- D: 1
- E: 1

## 6. Prerequisite Depth

Только PREREQUISITE рёбра: A→B, B→C

- A: нет входящих PREREQUISITE → depth = 0
- B: A→B, depth(A)=0 → depth = 0 + 1 = 1
- C: B→C, depth(B)=1 → depth = 1 + 1 = 2
- D: нет входящих PREREQUISITE → depth = 0
- E: D→E это ELABORATES, не PREREQUISITE → depth = 0

## 7. Learning Effort

difficulty по умолчанию = 3 (если не указано)
Суммируем difficulty по PREREQUISITE путям:

- A: difficulty(A) = 1 → effort = 1
- B: difficulty(B) + effort(A) = 2 + 1 = 3
- C: difficulty(C) + effort(B) = 3 + 3 = 6
- D: difficulty(D) = 2 → effort = 2
- E: difficulty(E) = 2 (нет PREREQUISITE предков) → effort = 2

## 8. Inverse Weight для рёбер

Все веса = 1.0, поэтому inverse_weight = 1.0 для всех рёбер:
- A→B: inverse_weight = 1.0
- B→C: inverse_weight = 1.0
- D→E: inverse_weight = 1.0

## 9. Educational Importance для test_disconnected_graph:

- A: 0.12088
- B: 0.22363
- C: 0.31097
- D: 0.12088
- E: 0.22363

Сумма: 1.000000

Значения совпадают с обычным PageRank, так как все рёбра графа (PREREQUISITE и ELABORATES) входят в educational_edge_types, и мы не реверсируем направления.

## Итоговая таблица метрик

| Узел | degree_in | degree_out | degree_centrality | pagerank | betweenness | out_closeness | component_id | prereq_depth | learning_effort | educational_importance |
|------|-----------|------------|-------------------|----------|-------------|---------------|--------------|--------------|-----------------|------------------------|
| A    | 0         | 1          | 0.25              | 0.1208825| 0.0         | 0.3333        | 0            | 0            | 1               | 0.12088                |
| B    | 1         | 1          | 0.5               | 0.2236326| 0.0833      | 0.25          | 0            | 1            | 3               | 0.22363                |
| C    | 1         | 0          | 0.25              | 0.3109697| 0.0         | 0.0           | 0            | 2            | 6               | 0.31097                |
| D    | 0         | 1          | 0.25              | 0.1208825| 0.0         | 0.25          | 1            | 0            | 2               | 0.12088                |
| E    | 1         | 0          | 0.25              | 0.2236326| 0.0         | 0.0           | 1            | 0            | 2               | 0.22363                |

## Проверки инвариантов

✓ Сумма PageRank = 0.9999999 ≈ 1.0
✓ component_id начинается с 0 и идёт последовательно (0, 1)
✓ prerequisite_depth ≥ 0 для всех узлов
✓ out_closeness корректно обрабатывает частичную достижимость
✓ betweenness = 0 для большинства узлов (только B = 0.0833 как мост в компоненте 0)