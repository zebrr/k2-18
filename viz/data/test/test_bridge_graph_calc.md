# test_bridge_graph: Расчёт метрик (исправленная версия)

## Структура графа

```
Кластер 1:           Мост:        Кластер 2:
A ←→ B                            E ←→ F
 ↘ ↙                               ↘ ↙
  C → → → → → → D → → → → → → → → E
```

**Рёбра:**
1. A → B (PARALLEL, 1.0)
2. B → C (PREREQUISITE, 1.0)
3. C → A (REFER_BACK, 1.0)
4. C → D (PREREQUISITE, 1.0) **[критическое ребро]**
5. D → E (PREREQUISITE, 1.0) **[критическое ребро]**
6. E → F (PARALLEL, 1.0)
7. F → G (PREREQUISITE, 1.0)
8. G → E (REFER_BACK, 1.0)
9. A → C (ELABORATES, 1.0)
10. E → G (ELABORATES, 1.0)

## 1. Степени вершин (Degrees)

| Node | In-edges | Out-edges | degree_in | degree_out |
|------|----------|-----------|-----------|------------|
| A | C→A | A→B, A→C | 1 | 2 |
| B | A→B | B→C | 1 | 1 |
| C | B→C, A→C | C→A, C→D | 2 | 2 |
| D | C→D | D→E | 1 | 1 |
| E | D→E, G→E | E→F, E→G | 2 | 2 |
| F | E→F | F→G | 1 | 1 |
| G | F→G, E→G | G→E | 2 | 1 |

**degree_centrality = (degree_in + degree_out) / (n - 1)**, где n = 7:
- A: (1 + 2) / 6 = 0.5
- B: (1 + 1) / 6 = 0.333...
- C: (2 + 2) / 6 = 0.666...
- D: (1 + 1) / 6 = 0.333...
- E: (2 + 2) / 6 = 0.666...
- F: (1 + 1) / 6 = 0.333...
- G: (2 + 1) / 6 = 0.5

## 2. PageRank (alpha = 0.85)

### После сходимости (62 итерации, вычислено через JS):
**Точные значения PageRank:**
- A: 0.0575
- B: 0.0459
- C: 0.0848
- D: 0.0575
- E: 0.3135 (максимум!)
- F: 0.1547
- G: 0.2861

**Проверка:** Сумма = 1.0000 ✓

**Анализ:**
- Кластер 2 (E+F+G) = 0.754 получает больше PageRank чем Кластер 1 (A+B+C) = 0.188
- Узел E имеет максимальный PageRank — получает поток от моста D и от G
- Мост D имеет низкий PageRank (0.0575) — только транзитный узел

## 3. Betweenness Centrality (ИСПРАВЛЕННАЯ ВЕРСИЯ)

### Определение:
Для направленного графа считаем ВСЕ упорядоченные пары (s,t) где s≠v≠t.
Узел v получает вклад σ_{st}(v)/σ_{st}, если он внутренний узел на кратчайшем пути от s к t.

### Подсчёт betweenness:

**Узел D** лежит на путях (как внутренний узел):
- A→E через A→C→D→E
- A→F через A→C→D→E→F
- A→G через A→C→D→E→G
- B→E через B→C→D→E
- B→F через B→C→D→E→F
- B→G через B→C→D→E→G
- C→E через C→D→E
- C→F через C→D→E→F
- C→G через C→D→E→G
Всего: 9 путей

**Узел C** лежит на путях (как внутренний узел):
- A→D через A→C→D
- A→E через A→C→D→E
- A→F через A→C→D→E→F
- A→G через A→C→D→E→G
- B→A через B→C→A
- B→D через B→C→D
- B→E через B→C→D→E
- B→F через B→C→D→E→F
- B→G через B→C→D→E→G
Всего: 9 путей

**Узел E** лежит на путях (как внутренний узел):
- A→F через A→C→D→E→F
- A→G через A→C→D→E→G
- B→F через B→C→D→E→F
- B→G через B→C→D→E→G
- C→F через C→D→E→F
- C→G через C→D→E→G
- D→F через D→E→F
- D→G через D→E→G
- G→F через G→E→F
Всего: 9 путей

**Узел A** лежит на путях (как внутренний узел):
- C→B через C→A→B
Всего: 1 путь

**Узел G** лежит на путях (как внутренний узел):
- F→E через F→G→E
Всего: 1 путь

**Узлы B и F**: не являются внутренними узлами ни на одном кратчайшем пути

### Нормализованные значения:
Для направленного графа: делим на (n-1)(n-2) = 6×5 = 30

- **A: 1/30 ≈ 0.0333**
- **B: 0/30 = 0.0**
- **C: 9/30 = 0.3**
- **D: 9/30 = 0.3**
- **E: 9/30 = 0.3**
- **F: 0/30 = 0.0**
- **G: 1/30 ≈ 0.0333**

## 4. Out-Closeness Centrality

### Формула:
Для узлов, достигающих k < n-1 узлов:
`closeness = (k / sum_distances) × (k / (n-1))`

### Расчёт для каждого узла:

**A:** Достигает 6 узлов (все)
- Расстояния: B(1), C(1), D(2), E(3), F(4), G(4)
- Сумма: 15
- Closeness: 6/15 = 0.4

**B:** Достигает 6 узлов
- Расстояния: A(2), C(1), D(2), E(3), F(4), G(4)
- Сумма: 16
- Closeness: 6/16 = 0.375

**C:** Достигает 6 узлов
- Расстояния: A(1), B(2), D(1), E(2), F(3), G(3)
- Сумма: 12
- Closeness: 6/12 = 0.5

**D:** Достигает 3 узла (E, F, G)
- Расстояния: E(1), F(2), G(2)
- Сумма: 5
- Closeness: (3/5) × (3/6) = 0.6 × 0.5 = 0.3

**E:** Достигает 2 узла (F, G)
- Расстояния: F(1), G(1)
- Сумма: 2
- Closeness: (2/2) × (2/6) = 1.0 × 0.333 = 0.333

**F:** Достигает 2 узла (E, G)
- Расстояния: G(1), E(2)
- Сумма: 3
- Closeness: (2/3) × (2/6) = 0.667 × 0.333 = 0.222

**G:** Достигает 2 узла (E, F)
- Расстояния: E(1), F(2)
- Сумма: 3
- Closeness: (2/3) × (2/6) = 0.667 × 0.333 = 0.222

## 5. Component ID

Все узлы в одной слабо связной компоненте:
- **Все узлы: component_id = 0**

## 6. Prerequisite Depth

Анализ PREREQUISITE рёбер:
- B → C
- C → D
- D → E
- F → G

**Уровни:**
- Уровень 0 (без входящих PREREQUISITE): **A, B, F**
- Уровень 1: **C** (от B), **G** (от F)
- Уровень 2: **D** (от C)
- Уровень 3: **E** (от D)

## 7. Learning Effort

**Формула:** difficulty(узла) + max(learning_effort предшественников по PREREQUISITE)

- **A:** difficulty(2) + 0 = **2**
- **B:** difficulty(2) + 0 = **2**
- **C:** difficulty(3) + learning_effort(B) = 3 + 2 = **5**
- **D:** difficulty(3) + learning_effort(C) = 3 + 5 = **8**
- **E:** difficulty(3) + learning_effort(D) = 3 + 8 = **11**
- **F:** difficulty(2) + 0 = **2**
- **G:** difficulty(2) + learning_effort(F) = 2 + 2 = **4**

## 8. Inverse Weights

Для всех рёбер с weight = 1.0:
**inverse_weight = 1.0 / 1.0 = 1.0**

## Educational Importance для test_bridge_graph:

Подграф включает 6 рёбер (только PREREQUISITE и ELABORATES):
- B→C, C→D, D→E, F→G (PREREQUISITE)
- A→C, E→G (ELABORATES)

Результаты:
- A: 0.05594
- B: 0.05594
- C: 0.15104
- D: 0.18432
- E: 0.21261
- F: 0.05594
- G: 0.28421
- Сумма: 1.00000 ✓

Топ-3 узла:
- G: 0.2842 — получает поток от F (PREREQUISITE) и E (ELABORATES)
- E: 0.2126 — центральный в учебной цепочке
- D: 0.1843 — мост в цепочке PREREQUISITE

Интересно: В отличие от обычного PageRank (где E максимальный), в educational importance лидирует G, потому что в учебном подграфе он накапливает больше важности через образовательные связи!

## Итоговая таблица метрик (ИСПРАВЛЕННАЯ)

| Узел | degree_in | degree_out | degree_centrality | pagerank | betweenness | closeness | component_id | prereq_depth | learning_effort | educational_importance |
|------|-----------|------------|-------------------|----------|-------------|-----------|--------------|--------------|-----------------|------------------------|
| A    | 1         | 2          | 0.5               | 0.0575   | 0.0333      | 0.4       | 0            | 0            | 2               | 0.05594                |
| B    | 1         | 1          | 0.333             | 0.0459   | 0.0         | 0.375     | 0            | 0            | 2               | 0.05594                |
| C    | 2         | 2          | 0.667             | 0.0848   | 0.3         | 0.5       | 0            | 1            | 5               | 0.15104                |
| D    | 1         | 1          | 0.333             | 0.0575   | 0.3         | 0.3       | 0            | 2            | 8               | 0.18432                |
| E    | 2         | 2          | 0.667             | 0.3135   | 0.3         | 0.333     | 0            | 3            | 11              | 0.21261                |
| F    | 1         | 1          | 0.333             | 0.1547   | 0.0         | 0.222     | 0            | 0            | 2               | 0.05594                |
| G    | 2         | 1          | 0.5               | 0.2861   | 0.0333      | 0.222     | 0            | 1            | 4               | 0.28421                |

## Ключевые выводы

1. **Узлы C, D и E имеют одинаковый максимальный betweenness (0.3)** — все три критически важны для связности графа ✓
2. **Узел D — истинный мост** — его удаление разделит граф на две компоненты ✓
3. **Узлы C и E — соединители кластеров с мостом** — также имеют высокий betweenness ✓
4. **Узлы A и G имеют минимальный ненулевой betweenness (0.0333)** — участвуют в единичных путях ✓
5. **PageRank максимален у E (0.3135) и G (0.2861)** — накапливают поток в кластере 2 ✓
6. **Learning effort максимален у E (11)** — самая длинная цепочка PREREQUISITE ✓
7. **Out-closeness максимален у C (0.5)** — может достичь всех узлов с минимальной суммой расстояний ✓

## Что проверяет этот граф

1. **Корректность betweenness** — правильно ли находит критические узлы и мосты
2. **Равенство betweenness у разных типов критических узлов** — мост D и соединители C, E
3. **Обработка направленности** — учёт направлений в кратчайших путях
4. **Минимальные ненулевые значения** — узлы A и G с betweenness = 0.0333
5. **Нулевые значения betweenness** — узлы B и F не лежат на критических путях
