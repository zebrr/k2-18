# Test Cycle Graph: Пошаговые вычисления метрик

## Структура графа
Квадратный цикл: A→B→C→D→A
- 4 узла (n=4)
- 4 ребра
- Все веса = 1.0
- Все узлы имеют difficulty = 2
- Граф сильно связный (strongly connected)
- Граф симметричный - все узлы равноправны

## 1. Degree метрики

### Подсчет степеней
- **A**: in_degree=1 (от D), out_degree=1 (к B)
- **B**: in_degree=1 (от A), out_degree=1 (к C)
- **C**: in_degree=1 (от B), out_degree=1 (к D)
- **D**: in_degree=1 (от C), out_degree=1 (к A)

### Degree Centrality
Формула для directed: `(in_degree + out_degree) / (n - 1)` где n=4

- **Все узлы**: (1 + 1) / 3 = 2/3 = 0.6667

## 2. PageRank

### Исходные данные
- alpha (damping) = 0.85
- Начальное значение для каждого узла = 1/n = 0.25
- НЕТ висячих узлов (у всех есть исходящие рёбра)
- Все веса одинаковые (1.0)

### Итеративный расчет
Формула: `PR(v) = (1-α)/n + α * Σ(PR(u)/out_degree(u) * weight(u,v)/sum_weights(u))`

Так как у каждого узла ровно 1 исходящее ребро с весом 1.0:
- Каждый узел передает весь свой PageRank следующему узлу

**Итерация 0**: Все узлы = 0.25

**Итерация 1**:
- PR(A) = 0.15/4 + 0.85 * PR(D) = 0.0375 + 0.85 * 0.25 = 0.0375 + 0.2125 = 0.25
- PR(B) = 0.15/4 + 0.85 * PR(A) = 0.0375 + 0.85 * 0.25 = 0.0375 + 0.2125 = 0.25
- PR(C) = 0.15/4 + 0.85 * PR(B) = 0.0375 + 0.85 * 0.25 = 0.0375 + 0.2125 = 0.25
- PR(D) = 0.15/4 + 0.85 * PR(C) = 0.0375 + 0.85 * 0.25 = 0.0375 + 0.2125 = 0.25

**Результат**: Из-за полной симметрии цикла, PageRank остается равным для всех узлов
- **Все узлы**: PageRank = 0.25

### Проверка
Сумма = 0.25 * 4 = 1.0 ✓

## 3. Betweenness Centrality

### Формула
Betweenness = количество кратчайших путей через узел / общее количество кратчайших путей между всеми парами

### Анализ кратчайших путей в directed цикле
Для каждой пары узлов (s,t) где s≠t, есть уникальный кратчайший путь по направлению рёбер.

Всего пар: n*(n-1) = 4*3 = 12 упорядоченных пар

### Детальный подсчет путей через каждый узел
Рассмотрим узел B:
- A→C: путь A→B→C (B участвует)
- A→D: путь A→B→C→D (B участвует)
- C→A: путь C→D→A (B не участвует)
- C→D: путь C→D (B не участвует)
- D→A: путь D→A (B не участвует)
- D→B: путь D→A→B (A участвует, B - конечная точка, не считается)
- D→C: путь D→A→B→C (B участвует)

Итого для B: 3 пути из 12

По симметрии, каждый узел участвует ровно в 3 кратчайших путях.

### Нормализация для directed графов
Формула: `betweenness / ((n-1) * (n-2))` = `3 / (3 * 2)` = `3 / 6` = 0.5

**Результат**: Из-за симметрии цикла
- **Все узлы**: betweenness_centrality = 0.5

## 4. Closeness Centrality (OUT-closeness)

### Формула для directed графов
OUT-closeness измеряет, насколько близко узел к другим (исходящие пути).

### Расчет расстояний
В directed цикле от каждого узла (например, от A):
- До B: расстояние 1 (A→B)
- До C: расстояние 2 (A→B→C)
- До D: расстояние 3 (A→B→C→D)

Сумма расстояний = 1 + 2 + 3 = 6

### Расчет inverse weights и расстояний
inverse_weight = 1/weight = 1/1.0 = 1.0

Так как веса все равны 1.0, расстояния совпадают с количеством рёбер в пути.

### Формула closeness
Так как каждый узел достигает все n-1 = 3 узла:
`closeness = (n-1) / sum_distances = 3 / 6 = 0.5`

**Результат**: Из-за симметрии
- **Все узлы**: out-closeness = 0.5

## 5. Component ID
Все узлы в одной сильно связной компоненте (каждый достижим из каждого):
- **Все узлы**: component_id = 0

## 6. Prerequisite Depth
В цикле нет естественной иерархии - граф содержит цикл PREREQUISITE зависимостей.

Для циклических графов:
- Если строго следовать алгоритму топологической сортировки - невозможно определить
- Практическое решение: присвоить всем узлам depth = 0 (нет четкой иерархии)

**Результат**:
- **Все узлы**: prerequisite_depth = 0

## 7. Learning Effort
В циклическом PREREQUISITE-подграфе все узлы образуют одну сильносвязную компоненту.
Learning effort = сумма difficulty всех узлов в компоненте.
- Компонента: {A, B, C, D}
- Сумма difficulty: 2 + 2 + 2 + 2 = 8
- **Все узлы**: learning_effort = 8

## 8. Результаты расчета educational_importance для test_cycle_graph:

Educational Importance:

- chunk_a: 0.250000
- chunk_b: 0.250000
- chunk_c: 0.250000
- chunk_d: 0.250000
- Сумма = 1.000000 ✓
- Все значения равны (симметрия цикла) ✓

Вывод: В циклическом графе, где все рёбра типа PREREQUISITE образуют замкнутый цикл, educational_importance равномерно распределяется между всеми узлами (0.25 каждому). Это логично - в цикле нет более "важных" узлов с образовательной точки зрения, все равноправны.
Educational_importance в данном случае совпадает с обычным PageRank, так как:

Все рёбра имеют тип PREREQUISITE (входит в educational_edge_types)
- Граф симметричный
- Нет висячих узлов

## Инвертированные веса для рёбер
Для всех рёбер:
- weight = 1.0
- inverse_weight = 1.0 / 1.0 = 1.0

## Итоговая таблица метрик

| Узел | degree_in | degree_out | degree_centrality | pagerank | betweenness | closeness | component_id | prereq_depth | learning_effort | educational_importance |
|------|-----------|------------|-------------------|----------|-------------|-----------|--------------|--------------|-----------------|------------------------|
| A    | 1         | 1          | 0.6667            | 0.2500   | 0.5000      | 0.5000    | 0            | 0            | 8               | 0.250000               |
| B    | 1         | 1          | 0.6667            | 0.2500   | 0.5000      | 0.5000    | 0            | 0            | 8               | 0.250000               |
| C    | 1         | 1          | 0.6667            | 0.2500   | 0.5000      | 0.5000    | 0            | 0            | 8               | 0.250000               |
| D    | 1         | 1          | 0.6667            | 0.2500   | 0.5000      | 0.5000    | 0            | 0            | 8               | 0.250000               |

## Проверки инвариантов
- ✓ Сумма PageRank = 1.0000
- ✓ Все метрики одинаковые для всех узлов (симметрия цикла)
- ✓ Нет висячих узлов (все имеют out_degree = 1)
- ✓ Граф сильно связный (component_id = 0 для всех)
- ✓ Betweenness = 0.5 для всех (каждый участвует в 3 из 12 путей)
- ✓ Closeness = 0.5 (расстояния 1+2+3=6, closeness=3/6)

## Особенности циклического графа
1. **Полная симметрия**: Все узлы абсолютно равноправны
2. **Стабильный PageRank**: Значения не меняются при итерациях
3. **Равномерный betweenness**: Каждый узел одинаково важен для маршрутизации
4. **Циклические зависимости**: Невозможно определить иерархию prerequisite
5. **Идеальный тест**: Проверяет корректность обработки симметричных структур
